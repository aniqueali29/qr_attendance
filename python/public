<?php
/**
 * Test Database Connection
 * This script tests if MySQL is running and accessible
 */

// Database Configuration
$host = 'localhost';
$dbname = 'qr_attendance';
$username = 'root';
$password = '';

echo "🔍 Testing Database Connection\n";
echo "==============================\n";
echo "Host: $host\n";
echo "Database: $dbname\n";
echo "User: $username\n";
echo "Password: " . (empty($password) ? '(empty)' : '(set)') . "\n\n";

try {
    // Test connection
    $pdo = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    
    echo "✅ Database connection successful!\n";
    
    // Test if database exists and has tables
    $stmt = $pdo->query("SHOW TABLES");
    $tables = $stmt->fetchAll(PDO::FETCH_COLUMN);
    
    echo "📊 Database tables found: " . count($tables) . "\n";
    if (!empty($tables)) {
        echo "   Tables: " . implode(', ', $tables) . "\n";
    } else {
        echo "   ⚠️  No tables found - database might be empty\n";
    }
    
} catch (PDOException $e) {
    echo "❌ Database connection failed!\n";
    echo "Error: " . $e->getMessage() . "\n\n";
    
    if (strpos($e->getMessage(), '2002') !== false) {
        echo "💡 Solution: Start MySQL service in XAMPP Control Panel\n";
        echo "   1. Open XAMPP Control Panel\n";
        echo "   2. Click 'Start' next to MySQL\n";
        echo "   3. Wait for status to show 'Running'\n";
    } elseif (strpos($e->getMessage(), '1049') !== false) {
        echo "💡 Solution: Database 'qr_attendance' doesn't exist\n";
        echo "   1. Create the database in phpMyAdmin\n";
        echo "   2. Or run the database setup script\n";
    }
}

echo "\n" . str_repeat("=", 50) . "\n";
echo "Database connection test completed.\n";
?>
